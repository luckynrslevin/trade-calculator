<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trade Calculator</title>

    <style>
      /* General Styles */
      body {
        font-family: "Roboto", sans-serif;
        padding: 40px 20px;
        background-color: #f8f9fa;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      /* Form Styles */
      form {
        width: 480px; /* Fixed width for the form */
        background-color: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
      }

      /* Centered Header within the Form Box */
      .form-title {
        text-align: center;
        font-size: 2rem;
        color: #333;
        margin-bottom: 30px;
        font-weight: bold;
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        font-size: 1rem;
        color: #333;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        margin-bottom: 20px;
        font-size: 1rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      input:focus,
      select:focus {
        border-color: #4caf50;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        outline: none;
      }

      /* Result Box Styles */
      .result-box {
        width: 480px; /* Fixed width for result box */
        background-color: #fff;
        padding: 20px;
        margin-top: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
      }

      /* Error Message */
      .error {
        color: red;
        font-size: 1rem;
        text-align: center;
        margin-top: 10px;
        word-wrap: break-word; /* Line break for long error messages */
        white-space: normal; /* Prevents text from overflowing */
      }

      /* Results */
      #results,
      #sum {
        text-align: center;
        font-size: 1.2rem;
        color: #333;
        font-weight: 600;
        margin-top: 20px;
        word-wrap: break-word; /* Line break for long texts */
        white-space: normal; /* Prevents text from overflowing */
      }

      #results {
        color: #4caf50;
      }

      #sum {
        color: #555;
        font-weight: normal;
      }

      /* Hover Effects */
      input:hover,
      select:hover {
        border-color: #007bff;
      }

      /* Container for Layout */
      .container {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Input form Section -->
      <form id="calculation-form">
        <!-- Title inside the input box -->
        <div class="form-title">Trade Calculator</div>

        <label for="portfoliovalue">Portfolio value (€):</label>
        <input
          type="number"
          id="portfoliovalue"
          value="30000"
          required
          min="0.01"
          step="0.01"
        />

        <label for="risk">Portfolio risk (%):</label>
        <select id="risk" required>
          <option value="0.005">0,5%</option>
          <option value="0.01" selected>1,0%</option>
          <option value="0.02">2,0%</option>
        </select>

        <label for="price">Price (€):</label>
        <input type="number" id="price" required min="0.01" step="0.01" />

        <label for="stop">Stop (€):</label>
        <input type="number" id="stop" required min="0.01" step="0.01" />
      </form>

      <!-- Result Box to display results -->
      <div class="result-box">
        <h2 id="result">Waiting for Calculation...</h2>
        <p id="total-cost"></p>
        <p id="error-message" class="error"></p>
      </div>
    </div>

    <script>
      // Function to get URL parameters
      function getURLParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }
      
      // Inject values into the form fields based on the URL parameters
      window.onload = function() {
        const priceParam = getURLParam('price');
        const stopParam = getURLParam('stop');
        const riskParam = getURLParam('risk');
            
        if (priceParam) {
          document.getElementById('price').value = priceParam;
        }
        if (stopParam) {
          document.getElementById('stop').value = stopParam;
        }
        if (riskParam) {
          document.getElementById('risk').value = riskParam;
        }
      }
      
      // Function for Calculation
      function calculate() {
        // Reset error message and result
        document.getElementById("error-message").innerText = "";
        document.getElementById("result").innerText =
          "Waiting for Calculation...";
        document.getElementById("total-cost").innerText = "";

        // Get values from input fields
        const portfolioValue = parseFloat(
          document.getElementById("portfoliovalue").value
        );
        const portfolioRiskPercentage = parseFloat(
          document.getElementById("risk").value
        );
        const price = parseFloat(document.getElementById("price").value);
        const stop = parseFloat(document.getElementById("stop").value);

        // Calculate risk
        const risk = portfolioValue * portfolioRiskPercentage;

        // Validations
        if (
          isNaN(portfolioValue) ||
          isNaN(portfolioRiskPercentage) ||
          isNaN(price) ||
          isNaN(stop)
        ) {
          document.getElementById("error-message").innerText =
            "Error: Please enter valid numbers!";
          return;
        }

        if (portfolioValue <= 0 || price <= 0 || stop <= 0) {
          document.getElementById("error-message").innerText =
            "Error: All values must be greater than 0!";
          return;
        }

        if (stop > price) {
          document.getElementById("error-message").innerText =
            "Error: The stop value cannot be greater than the price!";
          return;
        }

        if (price === stop) {
          document.getElementById("error-message").innerText =
            "Error: Price and stop cannot be the same!";
          return;
        }

        // Calculation
        if (price > stop) {
          const amount = risk / (price - stop);
          const totalCost = amount * price;

          // Format the results
          const amountFormatted = Math.round(amount).toLocaleString("de-DE");
          const totalCostFormatted = totalCost.toLocaleString("de-DE", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          });

          // Display results
          document.getElementById(
            "result"
          ).innerText = `The amount is: ${amountFormatted} units`;
          document.getElementById(
            "total-cost"
          ).innerText = `Total cost: ${totalCostFormatted} €`;
        } else {
          document.getElementById("result").innerText =
            "The price must be greater than the stop!";
        }
      }

      // Event Listener for all input fields
      document
        .getElementById("portfoliovalue")
        .addEventListener("input", calculate);
      document
        .getElementById("risk")
        .addEventListener("change", calculate);
      document.getElementById("price").addEventListener("input", calculate);
      document.getElementById("stop").addEventListener("input", calculate);
    </script>
  </body>
</html>
